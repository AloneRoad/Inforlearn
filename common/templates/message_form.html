{% load avatar nonce %}

{% if not request.user.spam %}
<div id="form-message" class="main">

  {% include 'form_error.html' %}
  {% block message_title %}{% endblock %}
  <form name="message_form" action="" method="POST">  
    {% if not request.mobile %}
      <a href="{{request.user.url}}/settings/photo">{{ request.user|avatar:"f" }}</a>
    {% endif %}
    <p id="message-container">
			<label for="message" id="message-label">Gõ tin nhắn bạn muốn chia sẻ với mọi người vào đây</label>
      <textarea id="message" name="message" rows="4" cols="25">{% if message %}{{ message|escape }}{% else %}{% if not request.mobile %}&nbsp;Bạn đang chú ý đến điều gì?{% endif %}{% endif %}</textarea>
    </p>
		<p class="buttons">
      <input type="hidden" id="location" name="location" value="{{ request.user.extra.location }}"/>
      <a onclick="document.message_form.submit();">
        <b style="font-size:2.5em;
                  text-decoration: none;
                  color: #FAFAFA;
                  cursor: pointer;">Gửi</b> <br/> 
        (Ctrl+Enter)
      </a>
<!--      <input type="submit" value="Gửi (Ctrl+Enter)" />-->
      <input type="hidden" name="nick" value="{{request.user.nick}}" />
      {% ifequal view.type 'user' %}
      {{request.user|noncefield:"post"}}
      <input type="hidden" name="post" value="" />
      {% else %}
      {{request.user|noncefield:"channel_post"}}
      <input type="hidden" name="channel_post" value="" />
      <input type="hidden" name="channel" value="{{view.nick}}" />
      {% endifequal %}
    </p>
    {% if not request.mobile %}
      <p id="counter">256</p>
      <p id="icons">
        <label for="icon" id="icon-label">Icon</label>
        <select name="icon" id="icon">
          <option value="">Chọn hình đại diện</option>
          {% for key, icon in selectable_icons.items %}
          <option value="{{ key }}" id="/themes/{{DEFAULT_THEME|urlencode}}/icons/{{ icon.0 }}.gif" title="{{ icon.2 }}"{% ifequal key current_icon %} selected="selected"{% endifequal %}>{{ icon.1 }}</option>
          {% endfor %}
        </select>
        <a href="#" id="add-icons">+ Hình đại diện</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        Gõ tiếng Việt (Ctrl+Space):
        <script src="{{request.user.url}}/../../js/avim.js" type="text/javascript"></script>
        <script src="{{request.user.url}}/../../js/shortcut.js" type="text/javascript"></script>
        <script type="text/javascript">
        shortcut.add("Ctrl+Space",function() {
          ob  = $(".image_language");
            if(defaultLang == "vn"){
                defaultLang = "en";
                ob.attr("src", "/themes/{{DEFAULT_THEME|urlencode}}/unchecked.png");
                AVIMObj.setMethod(-1);
            }
            else{
                defaultLang = "vn";
                ob.attr("src", "/themes/{{DEFAULT_THEME|urlencode}}/checked.png");
                AVIMObj.setMethod(0);
            }
        });
        </script>
        <script type="text/javascript">
        shortcut.add("Ctrl+Enter",function() {
          document.message_form.submit();
        });
        </script>
        
        
        <script type="text/javascript">
        var defaultLang = "vn";
        function toggle_lang(){
            ob  = $(".image_language");
            if(defaultLang == "vn"){
                defaultLang = "en";
                ob.attr("src", "/themes/{{DEFAULT_THEME|urlencode}}/unchecked.png");
                AVIMObj.setMethod(-1);
            }
            else{
                defaultLang = "vn";
                ob.attr("src", "/themes/{{DEFAULT_THEME|urlencode}}/checked.png");
                AVIMObj.setMethod(0);
            }
        }
        </script>
        <img class="image_language" 
             src="/themes/{{DEFAULT_THEME|urlencode}}/checked.png" 
             style="vertical-align:middle; 
                    display: inline; 
                    height: 16px; 
                    width: 16px;
                    margin-left: 1px;
                    margin-bottom: 7px;" 
             onclick="toggle_lang()">
      </p>
      
      
    {% endif %}
  </form>
</div>
{% else %}
<div class="main">
  <h3>Yêu cầu gửi bị từ chối</h3> nút chuyển tiếng anh tiếng việt bộ gõ
  <p>
  Ban không được phép gửi tin bởi các hoạt động của bạn bị hệ thống lọc spam nghi
  ngờ. Nếu bạn nghĩ đây là một lỗi, vui lòng gửi mô tả chi tiết vào nhóm #Bugs 
  để chúng tôi xem xét và sửa lại.
  </p>
</div>
{% endif %}
